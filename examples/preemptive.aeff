operation stop : int
operation go : int

let (waitForStop : int -> unit) threadID =
    promise (stop threadID' k when threadID = threadID' |->
        promise (go threadID' when threadID = threadID' |->
            <<()>>
        ) as p in
        await p until <<_>> in
        k ()
    ) as _ in
    ()

run
  waitForStop 1; 1 + 1 + 1 + 1 + 1

run
  waitForStop 2; 10 + 10 + 10 + 10 + 10